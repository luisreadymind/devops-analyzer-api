<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard de Madurez DevOps</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Bootstrap & Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <!-- Local Styles -->
  <link rel="stylesheet" href="report-template.css">
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.6/dist/chart.umd.min.js"></script>
  <!-- Tabulator (para tabla tipo Power BI) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tabulator-tables@6.2.5/dist/css/tabulator_bootstrap5.min.css">
  <script src="https://cdn.jsdelivr.net/npm/tabulator-tables@6.2.5/dist/js/tabulator.min.js"></script>
</head>
<body>
  <div class="app-shell">
    <!-- NAV -->
    <aside class="left-nav">
      <div class="brand">
        <i class="bi bi-app-indicator"></i>
        <div>
          Dashboard DevOps
          <small>Azure CAF / WAF / DevOps</small>
        </div>
      </div>
      <div class="nav-item active" data-section-key="dashboard" onclick="switchSection('dashboard')">
        <i class="bi bi-grid-1x2"></i> <span>Panel general</span>
      </div>
      <div class="nav-item" data-section-key="agile" onclick="switchSection('agile')">
        <i class="bi bi-card-checklist"></i> <span>Agile Software Development</span>
      </div>
      <div class="nav-item" data-section-key="versionControl" onclick="switchSection('versionControl')">
        <i class="bi bi-git"></i> <span>Control de Versiones</span>
      </div>
      <div class="nav-item" data-section-key="cicd" onclick="switchSection('cicd')">
        <i class="bi bi-robot"></i> <span>CI/CD</span>
      </div>
      <div class="nav-item" data-section-key="infra" onclick="switchSection('infra')">
        <i class="bi bi-cloud"></i> <span>Infraestructura Flexible</span>
      </div>
      <div class="nav-item" data-section-key="seguridad" onclick="switchSection('seguridad')">
        <i class="bi bi-shield-lock"></i> <span>Seguridad Continua</span>
      </div>
      <div class="nav-item" data-section-key="config" onclick="switchSection('config')">
        <i class="bi bi-gear"></i> <span>Admin. de Configuración</span>
      </div>
      <div class="nav-item" data-section-key="monitoring" onclick="switchSection('monitoring')">
        <i class="bi bi-activity"></i> <span>Supervisión Continua</span>
      </div>
      <div class="nav-item" data-section-key="cultura" onclick="switchSection('cultura')">
        <i class="bi bi-people"></i> <span>Cultura DevOps</span>
      </div>
      <div class="nav-item" data-section-key="roadmap" onclick="switchSection('roadmap')">
        <i class="bi bi-kanban"></i> <span>Roadmap 4 meses</span>
      </div>
      <div class="nav-item" data-section-key="fuente" onclick="switchSection('fuente')">
        <i class="bi bi-filetype-pdf"></i> <span>Fuente: Documento</span>
      </div>
    </aside>

    <!-- MAIN -->
    <main class="main-view">
      <header class="topbar">
        <div>
          <div class="topbar-title">Evaluación de Madurez DevOps</div>
          <div class="small-text">Basado en respuestas de assessment y mapeo a CMMI / Azure Well-Architected.</div>
        </div>
        <div class="d-flex align-items-center gap-2">
          <span class="badge-env">Tenant: Producción</span>
          <button class="btn-export" onclick="exportHTML()"><i class="bi bi-download"></i> Exportar HTML</button>
        </div>
      </header>

      <section class="content-area">
        <!-- KPI ROW -->
        <div class="kpi-grid">
          <div class="kpi">
            <div class="kpi-label"><i class="bi bi-speedometer2"></i> Madurez global</div>
            <div class="kpi-value">-- %</div>
            <div class="kpi-sub">Objetivo a 4 meses: -- %</div>
          </div>
          <div class="kpi">
            <div class="kpi-label"><i class="bi bi-stack"></i> CI/CD</div>
            <div class="kpi-value">-- %</div>
            <div class="kpi-sub">Pipelines con gates y PR</div>
          </div>
          <div class="kpi">
            <div class="kpi-label"><i class="bi bi-shield-check"></i> Seguridad</div>
            <div class="kpi-value">-- %</div>
            <div class="kpi-sub">Key Vault + Defender for Cloud</div>
          </div>
          <div class="kpi">
            <div class="kpi-label"><i class="bi bi-cloud-arrow-up"></i> Infraestructura flexible</div>
            <div class="kpi-value">-- %</div>
            <div class="kpi-sub">AKS / AppService con IaC</div>
          </div>
        </div>

        <!-- DASHBOARD SECTIONS -->
        <div class="grid-2 mt-3" id="section-dashboard">
          <div class="panel">
            <div class="panel-title">
              <span>Radar CMMI (8 dimensiones)</span>
              <span class="small-text">Niveles: Inicial 0–30 · Gestionado 31–60 · Definido 61–85 · Optimizado 86–100</span>
            </div>
            <div class="chart-wrapper">
                <canvas id="radar"></canvas>
            </div>
          </div>
          <div class="panel">
            <div class="panel-title">
              <span>Distribución por capacidad</span>
              <span class="small-text">Vista tipo Power BI</span>
            </div>
            <div class="chart-wrapper">
                <canvas id="bars"></canvas>
            </div>
          </div>
        </div>

        <div class="grid-2 mt-3" id="section-dashboard-2">
          <div class="panel">
            <div class="panel-title">
              <span>Evolución proyectada 4 meses</span>
              <span class="small-text">Escenario: implementación de recomendaciones</span>
            </div>
            <div class="chart-wrapper">
                <canvas id="line"></canvas>
            </div>
          </div>
          <div class="panel">
            <div class="panel-title">
              <span>Metadatos de evaluación</span>
            </div>
            <p class="small-text mb-1">• Origen del assessment: <strong>Documento PDF</strong></p>
            <p class="small-text mb-2">• Framework de referencia: <strong>Azure CAF, Azure Well-Architected, Microsoft DevOps Practices</strong></p>
            <div class="small-text">• Fecha de exportación: <span id="now"></span></div>
          </div>
        </div>

        <!-- DYNAMIC AREA SECTIONS -->
        <div class="grid-2 mt-3 d-none" id="section-agile">
          <div class="panel">
            <div class="panel-title"><span>Agile Software Development</span></div>
            <h5 class="small-text" style="font-weight: bold;">Evaluación</h5>
            <p class="small-text" data-content="assessment">Aquí va la evaluación del área...</p>
            <h5 class="small-text" style="font-weight: bold;">Recomendaciones</h5>
            <p class="small-text" data-content="recommendations">Aquí van las recomendaciones del área...</p>
          </div>
          <div class="panel">
             <div class="panel-title"><span>Indicadores Sugeridos</span></div>
            <ul class="small-text mb-0">
              <li>Velocity del equipo</li>
              <li>Cycle Time</li>
              <li>Gráficos Burndown/Burnup</li>
              <li>Satisfacción del cliente/usuario</li>
            </ul>
            <div class="panel-title mt-3"><span>Servicios Azure Clave</span></div>
            <ul class="small-text mb-0">
              <li>Azure Boards</li>
            </ul>
          </div>
        </div>
        
        <!-- SECTION ROADMAP -->
        <div class="mt-3 d-none" id="section-roadmap">
          <div class="panel mb-3">
            <div class="panel-title">
              <span>Roadmap de implementación (≤ 4 meses)</span>
              <span class="small-text">Roles: Arquitecto Cloud, DevOps, QA, PM</span>
            </div>
            <div class="table-responsive">
              <table class="table table-sm table-hover align-middle mb-0">
                <thead class="table-light">
                  <tr>
                    <th scope="col">ID</th>
                    <th scope="col">Actividad</th>
                    <th scope="col">Horas</th>
                    <th scope="col">Dependencia</th>
                    <th scope="col">Rol</th>
                  </tr>
                </thead>
                <tbody class="small-text" id="roadmap-body">
                  <!-- Placeholder for roadmap rows -->
                  <tr class="table-info fw-semibold"><td></td><td>Total estimado</td><td id="total-hours">-- h</td><td>—</td><td>—</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- SECTION FUENTE -->
        <div class="mt-3 d-none" id="section-fuente">
          <div class="panel">
            <div class="panel-title"><span>Fuente de datos</span></div>
            <p class="small-text mb-1">Este dashboard se generó a partir de un documento PDF analizado por un modelo de IA generativa.</p>
            <p class="small-text mb-1">La estructura aplica la guía: <strong>Microsoft Azure Learning Paths</strong>, <strong>Azure Well-Architected Framework</strong>, <strong>Cloud Adoption Framework</strong> y <strong>Microsoft DevOps Practices</strong>.</p>
          </div>
        </div>

        <!-- TABLA DE RECOMENDACIONES -->
        <div class="table-wrap mt-3" id="section-recomendaciones">
          <div class="panel-title mb-2">
            <span>Recomendaciones habilitadoras Azure (prioridad técnica)</span>
            <span class="small-text">Filtrable</span>
          </div>
          <div id="rec-table"></div>
        </div>

      </section>
    </main>
  </div>

  <script>
    // --- SAMPLE DATA (to be replaced by dynamic injection) ---
    const dimensiones = [
        {nombre: "Agile Software Development", valor: 35, nivel: "GESTIONADO", assessment: "Las prácticas ágiles son inconsistentes. Se realizan ceremonias pero sin un seguimiento riguroso de métricas como la velocidad.", recommendations: "Implementar Azure Boards para un seguimiento estandarizado de sprints. Capacitar al equipo en la estimación de historias de usuario."},
        {nombre: "Control de Versiones", valor: 65, nivel: "DEFINIDO", assessment: "Se utiliza Git con una estrategia de ramas básica. Las revisiones de código (PRs) existen pero no son obligatorias.", recommendations: "Habilitar políticas de ramas en Azure Repos para proteger 'main' y requerir un mínimo de aprobadores en los PRs."},
        {nombre: "CI/CD", valor: 40, nivel: "GESTIONADO", assessment: "Existen pipelines de CI, pero los despliegues a producción son manuales y requieren mucho tiempo.", recommendations: "Crear pipelines de Release en Azure Pipelines con stages y gates de aprobación para automatizar el despliegue a entornos de QA y Producción."},
        {nombre: "Infraestructura Flexible", valor: 25, nivel: "INICIAL", assessment: "La infraestructura se aprovisiona manualmente desde el portal de Azure, lo que genera inconsistencias y es lento.", recommendations: "Adoptar Infraestructura como Código (IaC) utilizando Bicep o ARM Templates para automatizar el aprovisionamiento de recursos de forma repetible y segura."},
        {nombre: "Seguridad Continua", valor: 30, nivel: "INICIAL", assessment: "La gestión de secretos no está centralizada; se encuentran credenciales en archivos de configuración.", recommendations: "Migrar todos los secretos de aplicación a Azure Key Vault e integrarlo con los servicios de Azure para un acceso seguro."},
        {nombre: "Admin. de Configuración", valor: 55, nivel: "GESTIONADO", assessment: "La configuración se maneja por entorno, pero su gestión es manual y propensa a errores.", recommendations: "Utilizar Azure App Configuration para centralizar la configuración de las aplicaciones y gestionarla de forma dinámica sin necesidad de redesplegar."},
        {nombre: "Supervisión Continua", valor: 20, nivel: "INICIAL", assessment: "El monitoreo se limita a las métricas básicas de la plataforma. No hay una observabilidad profunda de las aplicaciones.", recommendations: "Integrar Application Insights en las aplicaciones para obtener telemetría detallada, seguimiento de dependencias y detección de anomalías."},
        {nombre: "Cultura DevOps", valor: 45, nivel: "GESTIONADO", assessment: "Hay colaboración entre equipos, pero los silos persisten. Falta una cultura de 'blameless postmortems'.", recommendations: "Fomentar la creación de equipos multifuncionales y establecer un proceso formal para el análisis de incidentes, centrado en la mejora de procesos y no en la búsqueda de culpables."},
    ];
    const promedio = 40;
    const objetivo = 75;
    const evolucion = [40, 49, 58, 67, 75];
    const recomendaciones = [
        {id: "T-01", recomendacion: "Definir política de ramas en Azure Repos para proteger `main` y requerir PRs.", prioridad: "Alta", servicio: "Azure Repos", esfuerzo_h: 8, dependencia: '', role: 'Ingeniero DevOps'},
        {id: "T-02", recomendacion: "Centralizar la gestión de secretos de aplicación en Azure Key Vault.", prioridad: "Alta", servicio: "Azure Key Vault", esfuerzo_h: 24, dependencia: '', role: 'Arquitecto Cloud'},
        {id: "T-03", recomendacion: "Implementar un pipeline de CI/CD básico para una aplicación piloto.", prioridad: "Alta", servicio: "Azure DevOps Pipelines", esfuerzo_h: 40, dependencia: 'T-01', role: 'Ingeniero DevOps'},
        {id: "T-04", recomendacion: "Capacitar al equipo en prácticas de IaC con Bicep.", prioridad: "Media", servicio: "Microsoft Learn", esfuerzo_h: 16, dependencia: '', role: 'PM'},
    ];

    // --- Update UI with sample data ---
    document.addEventListener("DOMContentLoaded", function() {
        // KPIs
        document.querySelector('.kpi-grid .kpi:nth-child(1) .kpi-value').textContent = promedio + ' %';
        document.querySelector('.kpi-grid .kpi:nth-child(1) .kpi-sub').textContent = 'Objetivo a 4 meses: ' + objetivo + ' %';
        document.querySelector('.kpi-grid .kpi:nth-child(2) .kpi-value').textContent = (dimensiones.find(d => d.nombre.includes("CI/CD"))?.valor || '--') + ' %';
        document.querySelector('.kpi-grid .kpi:nth-child(3) .kpi-value').textContent = (dimensiones.find(d => d.nombre.includes("Seguridad"))?.valor || '--') + ' %';
        document.querySelector('.kpi-grid .kpi:nth-child(4) .kpi-value').textContent = (dimensiones.find(d => d.nombre.includes("Infraestructura"))?.valor || '--') + ' %';
        
        // Roadmap
        const totalHours = recomendaciones.reduce((acc, r) => acc + r.esfuerzo_h, 0);
        document.getElementById('total-hours').textContent = totalHours + ' h';
        const roadmapBody = document.getElementById('roadmap-body');
        recomendaciones.forEach(rec => {
            const row = document.createElement('tr');
            row.innerHTML = `<td>${rec.id}</td><td>${rec.recomendacion}</td><td>${rec.esfuerzo_h}</td><td>${rec.dependencia || '—'}</td><td>${rec.role}</td>`;
            roadmapBody.insertBefore(row, roadmapBody.querySelector('.table-info'));
        });

        // Detailed sections
        const agileSection = document.getElementById('section-agile');
        const agileData = dimensiones.find(d => d.nombre.includes('Agile'));
        if (agileSection && agileData) {
            agileSection.querySelector('[data-content="assessment"]').innerHTML = agileData.assessment.replace(/\n/g, '<br>');
            agileSection.querySelector('[data-content="recommendations"]').innerHTML = agileData.recommendations.replace(/\n/g, '<br>');
        }
    
        // Init
        document.getElementById("now").innerText = new Date().toLocaleString("es-ES", { dateStyle: "full", timeStyle: "short" });

        // Charts
        const radarCtx = document.getElementById("radar");
        new Chart(radarCtx, {
          type: "radar",
          data: {
            labels: dimensiones.map(d => d.nombre),
            datasets: [
              {
                label: "Estado actual",
                data: dimensiones.map(d => d.valor),
                fill: true,
                backgroundColor: "rgba(0,120,212,0.25)",
                borderColor: "rgba(0,120,212,1)",
                pointBackgroundColor: "rgba(0,120,212,1)",
                borderWidth: 2
              },
              {
                label: "Objetivo 4 meses",
                data: dimensiones.map(d => Math.min(100, d.valor + (objetivo - promedio))),
                fill: true,
                backgroundColor: "rgba(142,76,198,0.12)",
                borderColor: "rgba(142,76,198,.9)",
                pointBackgroundColor: "rgba(142,76,198,1)",
                borderWidth: 1.2
              }
            ]
          },
          options: { responsive: true, maintainAspectRatio: false, scales: { r: { suggestedMin: 0, suggestedMax: 100, ticks: { stepSize: 20 } } }, plugins: { legend: { position: "bottom" } } }
        });

        const barCtx = document.getElementById("bars");
        new Chart(barCtx, {
          type: "bar",
          data: {
            labels: dimensiones.map(d => d.nombre),
            datasets: [{ label: "Nivel (%)", data: dimensiones.map(d => d.valor), backgroundColor: "rgba(0,120,212,0.7)" }]
          },
          options: { responsive: true, maintainAspectRatio: false, indexAxis: "y", plugins: { legend: { display: false } }, scales: { x: { max: 100, beginAtZero: true } } }
        });

        const lineCtx = document.getElementById("line");
        new Chart(lineCtx, {
          type: "line",
          data: {
            labels: ["T0 (actual)", "Mes 1", "Mes 2", "Mes 3", "Mes 4"],
            datasets: [
              { label: "Madurez global", data: evolucion, borderColor: "rgba(0,120,212,1)", backgroundColor: "rgba(0,120,212,.2)", tension: .35, fill: true },
              { label: "Objetivo CAF", data: [objetivo, objetivo, objetivo, objetivo, objetivo], borderColor: "rgba(142,76,198,.9)", borderDash: [5,5], tension: 0 }
            ]
          },
          options: { responsive: true, maintainAspectRatio: false, scales: { y: { max: 100, beginAtZero: true } } }
        });

        // Recommendations Table
        new Tabulator("#rec-table", {
          data: recomendaciones,
          layout: "fitData",
          pagination: true,
          paginationSize: 5,
          columns: [
            { title: "ID", field: "id", width: 60, resizable: false },
            { title: "Recomendación", field: "recomendacion", minWidth: 280, formatter: "textarea" },
            { title: "Prioridad", field: "prioridad", width: 100, resizable: false, headerFilter: "select", headerFilterParams: {"": "Todas", "Alta":"Alta","Media":"Media","Baja":"Baja"} },
            { title: "Servicio Azure", field: "servicio", minWidth: 150, headerFilter: true },
            { title: "Esfuerzo (h)", field: "esfuerzo_h", hozAlign: "right", width: 120, resizable: false }
          ]
        });
    });

    // --- NAVIGATION ---
    function switchSection(sectionKey) {
        document.querySelectorAll(".left-nav .nav-item").forEach(el => el.classList.remove("active"));
        document.querySelectorAll(".main-view .content-area > [id^='section-']").forEach(el => el.classList.add('d-none'));
        document.querySelector('.nav-item[data-section-key="' + sectionKey + '"]')?.classList.add("active");
        
        const recTable = document.getElementById('section-recomendaciones');
        if (recTable && sectionKey !== 'roadmap' && sectionKey !== 'fuente') {
             recTable.classList.remove('d-none');
        }

        if (sectionKey === 'dashboard') {
            document.getElementById('section-dashboard')?.classList.remove('d-none');
            document.getElementById('section-dashboard-2')?.classList.remove('d-none');
        } else {
            document.getElementById('section-' + sectionKey)?.classList.remove('d-none');
        }
    }

    // --- EXPORT ---
    function exportHTML() {
      const blob = new Blob([document.documentElement.outerHTML], {type: "text/html"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "dashboard-devops-analisis.html";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
